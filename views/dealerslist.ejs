<%- include('./includes/head.ejs') %>


    <div class="container-fluid">
        <div class="d-sm-flex align-items-center justify-content-between mb-4">
            <h1 class="h3 mb-0 text-gray-800" id="sellerslistheading">
                Sellers List
            </h1>
            <h1 class="h3 mb-0 text-gray-800" style="display:none" id="buyerslistheading">
                Buyers List
            </h1>
            <h6>From
                <%= start %> to
                    <%= end %>
            </h6>
        </div>

        <!-- Page Heading -->

        <div id="sellersum" class="row">

            <!-- Earnings (Monthly) Card Example -->
            <!-- Earnings (Monthly) Card Example -->
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-success shadow h-100 py-2">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Total Kg Purchase </div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800"><span id="totalpurchasekg"></span></div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-rupee-sign fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-primary shadow h-100 py-2">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">Total Purchase amount</div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800"><span id="totalpurchasesum"></span></div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-rupee-sign fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-success shadow h-100 py-2">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Total amount paid </div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800"><span id="totalpurchasepaid"></span></div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-rupee-sign fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-success shadow h-100 py-2">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Remaining amount </div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800"><span id="totalpurchaseremaining"></span></div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-rupee-sign fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <div id="buyersum" style="display: none;" class="row">

            <!-- Earnings (Monthly) Card Example -->
            <!-- Earnings (Monthly) Card Example -->
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-success shadow h-100 py-2">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Total Kg sales </div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800"><span id="totalsaleskg"></span></div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-rupee-sign fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-primary shadow h-100 py-2">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">Total sales amount</div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800"><span id="totalsalesamount"></span></div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-rupee-sign fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-success shadow h-100 py-2">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Total amount Recieved </div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800"><span id="totalamountrecieved"></span></div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-rupee-sign fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-success shadow h-100 py-2">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Remaining amount </div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800"><span id="totalsalesremaining"></span></div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-rupee-sign fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <!-- DataTales Example -->
        <div id="sellerslistss" class="card shadow mb-4">

            <div class="card-header py-3">

                <button class="btn btn-success float-right" id="buyerslistbutton">Buyers List</button>
                <a class="float-right btn btn-danger mr-2" href="" href="" data-toggle="modal" data-target="#filtermodel">Filter</a>



                <br>

            </div>


            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                        <thead>
                            <tr>

                                <th>Name</th>
                                <th>Total purchase kg</th>
                                <th>Purchase amount</th>
                                <th>Amount Paid</th>
                                <th>Difference</th>
                                <th>Total Storage</th>
                                <th>Delete</th>
                            </tr>
                        </thead>
                        <tfoot>
                            <tr>

                                <th>Name</th>
                                <th>Total purchase kg</th>
                                <th>Purchase amount</th>
                                <th>Amount Paid</th>
                                <th>Difference</th>
                                <th>Total Storage</th>
                                <th>Delete</th>
                            </tr>
                        </tfoot>
                        <tbody>


                            <%
                            var purchaseamount = 0;
                            var purchasekg = 0;
                            var purchasepaid = 0;
                 
                            for(var i = 0; i < dics.length; i++){
                                purchaseamount = parseInt(dics[i].totalsales) + parseInt(purchaseamount)
                                purchasekg = parseInt(dics[i].totalkg) + parseInt(purchasekg)
                                purchasepaid = parseInt(dics[i].totalpaid) + parseInt(purchasepaid)
                                %>
                                <tr>

                                    <td>
                                        <a href="/individualpurchase/<%=dics[i].name%>">
                                            <%= dics[i].name%>
                                        </a>
                                    </td>
                                    <td>
                                        <%= dics[i].totalkg.toLocaleString()%>
                                    </td>
                                    <td>
                                        <%= dics[i].totalsales.toLocaleString()%>
                                    </td>
                                    <td>
                                        <%= dics[i].totalpaid.toLocaleString()%>
                                    </td>
                                    <td>
                                        <%= (parseInt(dics[i].totalsales) - parseInt(dics[i].totalpaid)).toLocaleString()  %>
                                    </td>
                                    <td>
                                        <%=dics[i].totalstorage.toLocaleString()%>
                                    </td>
                                    <td><a href="#" onclick="deletedealer('<%=i%>','purchase')" class="btn btn-primary">edit</a>
                                </tr>
                                <%}%>


                        </tbody>
                    </table>
                </div>
            </div>




        </div>


        <div id="buyerslist" style="display: none;" class="card shadow mb-4">
            <div class="card-header py-3">

                <button class="btn btn-success float-right" id="sellerslist">Sellers List</button>
                <a class="float-right btn btn-danger mr-2" href="" href="" data-toggle="modal" data-target="#filtermodel">Filter</a>

                <br>

            </div>


            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-bordered" id="MyTable" width="100%" cellspacing="0">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Total Sales kg</th>
                                <th>Sales amount</th>
                                <th>Amount Recieved</th>
                                <th>Difference</th>
                                <th>Total Remaining</th>
                                <th>Delete</th>
                            </tr>
                        </thead>
                        <tfoot>
                            <tr>
                                <tr>
                                    <th>Name</th>
                                    <th>Total Sales kg</th>
                                    <th>Sales amount</th>
                                    <th>Amount Recieved</th>
                                    <th>Difference</th>
                                    <th>Total Remaining</th>
                                    <th>Delete</th>
                                </tr>
                        </tfoot>
                        <tbody>
                            <%
                            var salestotal = 0;
                            var saleskg = 0;
                            var salespaid = 0;
                 
                            for(var i = 0; i < docs.length; i++){
                                salestotal = parseInt(docs[i].totalsales) + parseInt(salestotal)
                                saleskg = parseInt(docs[i].totalkg) + parseInt(saleskg)
                                salespaid = parseInt(docs[i].totalpaid) + parseInt(salespaid)
                                %>
                                <tr>

                                    <td>
                                        <a href="/individualsales/<%=docs[i].name%>">
                                            <%=docs[i].name%>
                                        </a>
                                    </td>
                                    <td>
                                        <%=docs[i].totalkg.toLocaleString()%>
                                    </td>
                                    <td>
                                        <%=docs[i].totalsales.toLocaleString()%>
                                    </td>
                                    <td>
                                        <%=docs[i].totalpaid.toLocaleString()%>
                                    </td>
                                    <td>
                                        <%= (parseInt(docs[i].totalsales) - parseInt(docs[i].totalpaid)).toLocaleString()  %>
                                    </td>
                                    <td>
                                        <%=docs[i].total.toLocaleString()%>
                                    </td>
                                    <td><a href="#" onclick="deletedealer('<%=i%>','sales')" class="btn btn-primary">edit</a>
                                </tr>
                                <%}%>

                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="modal fade" id="deletemodal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Are you sure you want to delete ?</h5>
                        <a class="close" type="button" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">×</span>
                        </a>
                    </div>

                    <div class="modal-body">
                        <h5 class="text-danger" id="exampleModalLabel">This action will delete <span id="accountcategory"></span> account of <span id="dealername"></span> </h5>
                        <form id="form1" action="" method="POST">
                            <div class="form-group row">
                                <div class="col-sm-12 mb-3 mb-sm-0">
                                    <label for="">Enter admin password to continue</label>
                                    <input type="text" required value="" class="form-control form-control-user" id="exampleFirstName" name="password" placeholder="Enter password">
                                </div>
                                <input type="hidden" name="objectid" id="objectid">
                            </div>
                        </form>

                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
                        <button class="btn btn-primary" type="submit" form="form1">Delete</button>
                    </div>
                </div>

            </div>
        </div>
        <div class="modal fade" id="filtermodel" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Filter dates</h5>
                        <a class="close" type="button" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">×</span>
                        </a>
                    </div>
                    <div class="modal-body">
                        <form id="form2" action="/filterdelerslist" method="POST">
                            <div class="form-group row">
                                <div class="col-sm-12 mb-3 mb-sm-0">
                                    <label for="">From date</label>
                                    <input type="date" value="<%=todaydate%>" class="form-control form-control-user" id="exampleFirstName" name="sdate" placeholder="Date">
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-sm-12 mb-3 mb-sm-0">
                                    <label for="">To date</label>
                                    <input type="date" value="<%=todaydate%>" name="edate" class="form-control form-control-user" id="exampleFirstName" placeholder="Date">
                                </div>


                            </div>




                        </form>

                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
                        <button class="btn btn-primary" type="submit" form="form2">Apply filter</button>
                    </div>
                </div>

            </div>
        </div>
        <script>
            function deletedealer(i, section) {
                var obj
                form = document.getElementById('form1')
                if (section == 'sales') {
                    obj = <%- JSON.stringify(docs) %>;
                    document.getElementById('accountcategory').innerText = "Sales";
                    form.action = '/deletedealersales'
                } else {
                    document.getElementById('accountcategory').innerText = "Purchase";
                    obj = <%- JSON.stringify(dics) %>;
                    form.action = '/deletedealerpurchase'
                }


                document.getElementById('dealername').innerText = obj[i].name;
                document.getElementById('objectid').value = obj[i].id;
                $('#deletemodal').modal('show')

            }
            $("#buyerslistbutton").click(function() {

                $('#buyerslist').show();
                $('#buyerslistheading').show();
                $('#sellerslistheading').hide();
                $('#buyersum').show();
                $('#sellersum').hide();
                $('#sellerslistss').hide();

            })
            $("#sellerslist").click(function() {
                $('#buyerslist').hide();
                $('#sellerslistss').show();
                $('#sellersum').show();
                $('#buyersum').hide();
                $('#buyerslistheading').hide();
                $('#sellerslistheading').show();
            })
        </script>
        <script>
            $(document).ready(function() {

                purchaseamount = <%=purchaseamount%>;
                purchasekg = <%=purchasekg%>;
                purchasepaid = <%=purchasepaid%>;
                remainingpurchase = purchaseamount - purchasepaid
                salesamount = <%=salestotal%>;
                saleskg = <%=saleskg%>;
                salespaid = <%=salespaid%>;
                salesremaining = salesamount - salespaid
                document.getElementById('totalpurchasekg').innerText = purchasekg.toLocaleString();
                document.getElementById('totalpurchasesum').innerText = purchaseamount.toLocaleString();
                document.getElementById('totalpurchasepaid').innerText = purchasepaid.toLocaleString();
                document.getElementById('totalpurchaseremaining').innerText = remainingpurchase.toLocaleString();
                document.getElementById('totalsaleskg').innerText = saleskg.toLocaleString();
                document.getElementById('totalsalesamount').innerText = salesamount.toLocaleString();
                document.getElementById('totalamountrecieved').innerText = salespaid.toLocaleString();
                document.getElementById('totalsalesremaining').innerText = salesremaining.toLocaleString();
                $('#dataTable').DataTable({

                    "lengthMenu": [
                        [10, 50, 100, -1],
                        [10, 50, 100, "All"]
                    ]

                });


            });


            $(document).ready(function() {

                $('#MyTable').DataTable({
                    initComplete: function() {
                        this.api().columns().every(function() {
                            var column = this;

                        });
                    },
                    "ordering": false,
                });
            });
        </script>
        <%- include('./includes/end.ejs') %>